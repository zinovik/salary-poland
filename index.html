<!DOCTYPE html>
<html>
	<head>
		<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
		<script>
			const INITIAL_BRUTTO = 17000;
			const INITIAL_TOTAL_WORKING_DAYS = 20;
			const INITIAL_WORKED_DAYS = 20;
			const INITIAL_PAYED_VACATIONS = 0;
			const INITIAL_LUX_MED = 56.80;
			const INITIAL_MY_BENEFIT = 100;

			const PENSION = 0.0976;
			const DISABILITY = 0.015;
			const SICKNESS = 0.0245;
			const HEALTH_INSURANCE = 0.09;
			const MAX_PENSION_YEAR = 17339.62;

			const round = (value) => Math.round(value * 100) / 100;
			const getSumBefore = (months, func, currentIndex) => months.reduce((sum, month, index) => index < currentIndex ? sum + func(months, index) : sum, 0);
			const getSum = (months, func) => months.reduce((sum, value, i) => sum + func(months, i), 0);
			const setAll = (months, name, value) => months.forEach((month) => month[name] = Number(value));

			const getWorking = (months, i) => round(months[i].brutto * ( months[i].workedDays / months[i].totalWorkingDays ));
			const getPaidVacations = (months, i) => round(months[i].brutto * ( months[i].payedVacations / months[i].totalWorkingDays ));
			const getTotalIncome = (months, i) => round(getWorking(months, i) + getPaidVacations(months, i) + months[i].luxMed + months[i].myBenefit);

			const getPensionMonth = (months, i) => round(getTotalIncome(months, i) * PENSION, MAX_PENSION_YEAR);
			const getPension = (months, i) => round(Math.min(getTotalIncome(months, i) * PENSION, MAX_PENSION_YEAR - getSumBefore(months, getPensionMonth, i)));
			const getDisability = (months, i) => round(getTotalIncome(months, i) * DISABILITY);
			const getSickness = (months, i) => round(getTotalIncome(months, i) * SICKNESS);
			const getTotalZusU = (months, i) => round(getPension(months, i) + getDisability(months, i) + getSickness(months, i));
			const getHealthInsuranceBasic = (months, i) => round(getTotalIncome(months, i) - getTotalZusU(months, i));
			const getHealthInsurance = (months, i) => round(getHealthInsuranceBasic(months, i) * HEALTH_INSURANCE);
		</script>
		<style type="text/css">
			table, th, td {
				border-collapse: collapse;
				border: 1px black solid;
			}
			input {
				width: 100;
			}
		</style>
	</head>

	<body>
		<div x-data="{
				months: [
					{ name: 'January' },
					{ name: 'February' },
					{ name: 'March' },
					{ name: 'April' },
					{ name: 'May' },
					{ name: 'June' },
					{ name: 'July' },
					{ name: 'August' },
					{ name: 'September' },
					{ name: 'October' },
					{ name: 'November' },
					{ name: 'December' },
				],
			}"
			x-init="months.forEach((_, i) => {
				months[i].brutto = INITIAL_BRUTTO;
				months[i].totalWorkingDays = INITIAL_TOTAL_WORKING_DAYS;
				months[i].workedDays = INITIAL_WORKED_DAYS;
				months[i].payedVacations = INITIAL_PAYED_VACATIONS;
				months[i].luxMed = INITIAL_LUX_MED;
				months[i].myBenefit = INITIAL_MY_BENEFIT;
			})"
		>
			<table>
				<tr>
					<th rowspan="3">Month</th>
					<th rowspan="3">BRUTTO</th>
					<th colspan="3">Days</th>
					<th colspan="5">INCOME</th>
					<th colspan="13">OUTCOME</th>
					<th rowspan="3">TOTAL NETTO</th>
				</tr>
				<tr>
					<th rowspan="2">Total working days</th>
					<th rowspan="2">Worked days</th>
					<th rowspan="2">Payed Vacations</th>
					<th colspan="2">Salary</th>
					<th colspan="2">Benefits</th>
					<th rowspan="2">TOTAL INCOME</th>
					<th colspan="6">ZUS (ubezpieczenie)</th>
					<th colspan="6">TAX</th>
					<th rowspan="2">TOTAL OUTCOME</th>
				</tr>
				<tr>
					<th>Working</th>
					<th>Paid Vacation</th>
					<th>Lux Med</th>
					<th>My Benefit</th>
					<th>Pension 9.76%</th>
					<th>Disability 9.76%</th>
					<th>Sickness 2.45%</th>
					<th>TOTAL ZUS U</th>
					<th>Basic for health insurance</th>
					<th>Health Insurance 9 %</th>
					<th>Income Costs</th>
					<th>Discount</th>
					<th>Basic for TAX (12 %)</th>
					<th>Basic for TAX (32 %)</th>
					<th>TAX 12%</th>
					<th>TAX 32%</th>
				</tr>

				<template x-for="(month, i) in months">
					<tr>
						<td><span x-text="month.name" /></td>
						<td><input type="number" size="6" x-model="months[i].brutto" /></td>
						<td><input type="number" size="6" x-model="months[i].totalWorkingDays" /></td>
						<td><input type="number" size="6" x-model="months[i].workedDays" /></td>
						<td><input type="number" size="6" x-model="months[i].payedVacations" /></td>
						<td><span x-text="getWorking(months, i)" /></td>
						<td><span x-text="getPaidVacations(months, i)" /></td>
						<td><input type="number" size="6" x-model="months[i].luxMed" /></td>
						<td><input type="number" size="6" x-model="months[i].myBenefit" /></td>
						<td><span x-text="getTotalIncome(months, i)" /></td>
						<td><span x-text="getPension(months, i)" /></td>
						<td><span x-text="getDisability(months, i)" /></td>
						<td><span x-text="getSickness(months, i)" /></td>
						<td><span x-text="getTotalZusU(months, i)" /></td>
						<td><span x-text="getHealthInsuranceBasic(months, i)" /></td>
						<td><span x-text="getHealthInsurance(months, i)" /></td>
						<td><span x-text="1" /></td>
						<td><span x-text="1" /></td>
						<td><span x-text="1" /></td>
						<td><span x-text="1" /></td>
						<td><span x-text="1" /></td>
						<td><span x-text="1" /></td>
						<td><span x-text="1" /></td>
						<td><span x-text="1" /></td>
					</tr>
				</template>

				<tr>
					<td>All:</td>
					<td><input type="number" size="6" @change="setAll(months, 'brutto', $event.target.value)" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'totalWorkingDays', $event.target.value)" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'workedDays', $event.target.value)" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'payedVacations', $event.target.value)" /></td>
					<td><span x-text="round(getSum(months, getWorking))" /></td>
					<td><span x-text="round(getSum(months, getPaidVacations))" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'luxMed', $event.target.value)" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'myBenefit', $event.target.value)" /></td>
					<td><span x-text="round(getSum(months, getTotalIncome))" /></td>
					<td><span x-text="round(getSum(months, getPension))" /></td>
				</tr>
			</table>
		</div>

	</body>
</html>
