<!DOCTYPE html>
<html>
	<head>
		<title>Salary Poland</title>
		<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
		<script>
			const INITIAL_BRUTTO = 17000;
			const INITIAL_TOTAL_WORKING_DAYS = 20;
			const INITIAL_WORKED_DAYS = 20;
			const INITIAL_PAYED_VACATIONS = 0;
			const INITIAL_LUX_MED = 56.80;
			const INITIAL_MY_BENEFIT = 100;

			const PENSION = 0.0976;
			const MAX_PENSION_YEAR = 17339.62;
			const DISABILITY = 0.015;
			const SICKNESS = 0.0245;
			const HEALTH_INSURANCE = 0.09;
			const INITIAL_INCOME_COST = 250;
			const INITIAL_DISCOUNT = -300;
			const TAX_LOW = 0.12;
			const MAX_TAX_LOW_YEAR = 120000;
			const TAX_HIGH = 0.32;

			const round = (value) => Math.round(value * 100) / 100;
			const getSumBefore = (months, func, currentIndex) => months.reduce((sum, month, index) => index < currentIndex ? sum + func(months, index) : sum, 0);
			const getSum = (months, func) => months.reduce((sum, value, i) => sum + func(months, i), 0);
			const getAverage = (months, func) => getSum(months, func) / months.length;
			const setAll = (months, name, value) => months.forEach((month) => month[name] = Number(value));

			const getWorking = (months, i) => round(months[i].brutto * ( months[i].workedDays / months[i].totalWorkingDays ));
			const getPaidVacations = (months, i) => round(months[i].brutto * ( months[i].payedVacations / months[i].totalWorkingDays ));
			const getTotalIncome = (months, i) => round(getWorking(months, i) + getPaidVacations(months, i) + Number(months[i].luxMed) + Number(months[i].myBenefit));

			const getPensionMonth = (months, i) => round(getTotalIncome(months, i) * PENSION);
			const getPension = (months, i) => round(Math.max(0, Math.min(getPensionMonth(months, i), MAX_PENSION_YEAR - getSumBefore(months, getPensionMonth, i))));

			const getDisability = (months, i) => round(getTotalIncome(months, i) * DISABILITY);
			const getSickness = (months, i) => round(getTotalIncome(months, i) * SICKNESS);
			const getTotalZusU = (months, i) => round(getPension(months, i) + getDisability(months, i) + getSickness(months, i));
			const getHealthInsuranceBasic = (months, i) => round(getTotalIncome(months, i) - getTotalZusU(months, i));
			const getHealthInsurance = (months, i) => round(getHealthInsuranceBasic(months, i) * HEALTH_INSURANCE);

			const getTaxLowBasicMonth = (months, i) => round(getTotalIncome(months, i) - getTotalZusU(months, i) - Number(months[i].incomeCost));
			const getTaxLowBasic = (months, i) => round(Math.max(0, Math.min(getTaxLowBasicMonth(months, i), MAX_TAX_LOW_YEAR - getSumBefore(months, getTaxLowBasicMonth, i))));
			const getTaxHighBasic = (months, i) => round(Math.max(0, getTotalIncome(months, i) - getTotalZusU(months, i) - Number(months[i].incomeCost) - getTaxLowBasic(months, i)));

			const getTaxLow = (months, i) => round(getTaxLowBasic(months, i) * TAX_LOW);
			const getTaxHigh = (months, i) => round(getTaxHighBasic(months, i) * TAX_HIGH);
			const getTotalTax = (months, i) => Math.floor(Math.max(0, getTaxLow(months, i) + getTaxHigh(months, i) + Number(months[i].discount)));
			const getTotalOutcome = (months, i) => round(getTotalZusU(months, i) + getHealthInsurance(months, i) + getTotalTax(months, i));
			const getNetto = (months, i) => round(getTotalIncome(months, i) - getTotalOutcome(months, i) - Number(months[i].luxMed) - Number(months[i].myBenefit));
			const getOutcomePercentage = (months, i) => round(getTotalOutcome(months, i) / getTotalIncome(months, i) * 100) || 0;
		</script>
		<style type="text/css">
			table, th, td {
				border-collapse: collapse;
				border: 1px black solid;
			}
			input {
				width: 100;
			}
		</style>
	</head>

	<body>
		<div x-data="{
				months: [
					{ name: 'January' },
					{ name: 'February' },
					{ name: 'March' },
					{ name: 'April' },
					{ name: 'May' },
					{ name: 'June' },
					{ name: 'July' },
					{ name: 'August' },
					{ name: 'September' },
					{ name: 'October' },
					{ name: 'November' },
					{ name: 'December' },
				],
			}"
			x-init="months.forEach((_, i) => {
				months[i].brutto = INITIAL_BRUTTO;
				months[i].totalWorkingDays = INITIAL_TOTAL_WORKING_DAYS;
				months[i].workedDays = INITIAL_WORKED_DAYS;
				months[i].payedVacations = INITIAL_PAYED_VACATIONS;
				months[i].luxMed = INITIAL_LUX_MED;
				months[i].myBenefit = INITIAL_MY_BENEFIT;
				months[i].incomeCost = INITIAL_INCOME_COST;
				months[i].discount = INITIAL_DISCOUNT;
			})"
		>
			<table>
				<tr>
					<th rowspan="3">Month</th>
					<th rowspan="3">BRUTTO</th>
					<th colspan="3">Days</th>
					<th colspan="5">INCOME</th>
					<th colspan="14">OUTCOME</th>
					<th rowspan="3">TOTAL NETTO</th>
					<th rowspan="3">Outcomes Percentage</th>
				</tr>
				<tr>
					<th rowspan="2">Total working days</th>
					<th rowspan="2">Worked days</th>
					<th rowspan="2">Payed Vacations</th>
					<th colspan="2">Salary</th>
					<th colspan="2">Benefits</th>
					<th rowspan="2">TOTAL INCOME</th>
					<th colspan="6">ZUS (ubezpieczenie)</th>
					<th colspan="7">TAX</th>
					<th rowspan="2">TOTAL OUTCOME</th>
				</tr>
				<tr>
					<th>Working</th>
					<th>Paid Vacation</th>
					<th>Lux Med</th>
					<th>My Benefit</th>
					<th>Pension 9.76%</th>
					<th>Disability 1.5%</th>
					<th>Sickness 2.45%</th>
					<th>TOTAL ZUS U</th>
					<th>Basic for Health Insurance</th>
					<th>Health Insurance 9 %</th>
					<th>Income Costs</th>
					<th>Discount</th>
					<th>Basic for TAX (12 %)</th>
					<th>Basic for TAX (32 %)</th>
					<th>TAX 12%</th>
					<th>TAX 32%</th>
					<th>TAX - Discount</th>
				</tr>

				<template x-for="(month, i) in months">
					<tr>
						<td><span x-text="month.name" /></td>
						<td><input type="number" size="6" x-model="months[i].brutto" /></td>
						<td><input type="number" size="6" x-model="months[i].totalWorkingDays" /></td>
						<td><input type="number" size="6" x-model="months[i].workedDays" /></td>
						<td><input type="number" size="6" x-model="months[i].payedVacations" /></td>
						<td><span x-text="getWorking(months, i)" /></td>
						<td><span x-text="getPaidVacations(months, i)" /></td>
						<td><input type="number" size="6" x-model="months[i].luxMed" /></td>
						<td><input type="number" size="6" x-model="months[i].myBenefit" /></td>
						<td><span x-text="getTotalIncome(months, i)" /></td>
						<td><span x-text="getPension(months, i)" /></td>
						<td><span x-text="getDisability(months, i)" /></td>
						<td><span x-text="getSickness(months, i)" /></td>
						<td><span x-text="getTotalZusU(months, i)" /></td>
						<td><span x-text="getHealthInsuranceBasic(months, i)" /></td>
						<td><span x-text="getHealthInsurance(months, i)" /></td>
						<td><input type="number" size="6" x-model="months[i].incomeCost" /></td>
						<td><input type="number" size="6" x-model="months[i].discount" /></td>
						<td><span x-text="getTaxLowBasic(months, i)" /></td>
						<td><span x-text="getTaxHighBasic(months, i)" /></td>
						<td><span x-text="getTaxLow(months, i)" /></td>
						<td><span x-text="getTaxHigh(months, i)" /></td>
						<td><span x-text="getTotalTax(months, i)" /></td>
						<td><span x-text="getTotalOutcome(months, i)" /></td>
						<td><span x-text="getNetto(months, i)" /></td>
						<td><span x-text="getOutcomePercentage(months, i)" /></td>
					</tr>
				</template>

				<tr>
					<td>TOTAL</td>
					<td><input type="number" size="6" @change="setAll(months, 'brutto', $event.target.value)" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'totalWorkingDays', $event.target.value)" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'workedDays', $event.target.value)" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'payedVacations', $event.target.value)" /></td>
					<td><span x-text="round(getSum(months, getWorking))" /></td>
					<td><span x-text="round(getSum(months, getPaidVacations))" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'luxMed', $event.target.value)" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'myBenefit', $event.target.value)" /></td>
					<td><span x-text="round(getSum(months, getTotalIncome))" /></td>
					<td><span x-text="round(getSum(months, getPension))" /></td>
					<td><span x-text="round(getSum(months, getDisability))" /></td>
					<td><span x-text="round(getSum(months, getSickness))" /></td>
					<td><span x-text="round(getSum(months, getTotalZusU))" /></td>
					<td><span x-text="round(getSum(months, getHealthInsuranceBasic))" /></td>
					<td><span x-text="round(getSum(months, getHealthInsurance))" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'incomeCost', $event.target.value)" /></td>
					<td><input type="number" size="6" @change="setAll(months, 'discount', $event.target.value)" /></td>
					<td><span x-text="round(getSum(months, getTaxLowBasic))" /></td>
					<td><span x-text="round(getSum(months, getTaxHighBasic))" /></td>
					<td><span x-text="round(getSum(months, getTaxLow))" /></td>
					<td><span x-text="round(getSum(months, getTaxHigh))" /></td>
					<td><span x-text="round(getSum(months, getTotalTax))" /></td>
					<td><span x-text="round(getSum(months, getTotalOutcome))" /></td>
					<td><span x-text="round(getSum(months, getNetto))" /></td>
					<td><span x-text="round(getAverage(months, getOutcomePercentage))" /></td>
				</tr>
			</table>
		</div>

	</body>
</html>
